- 2.1. Obtener el `BluetoothAdapter´

El `BluetoothAdapter`es necesario para cualquier actividad Bluetooth que se vaya a realizar. Primero se intenta obtener uno, y
en caso de que no se consiga es porque el dispositivo no es compatible con Bluetooth.

```
BluetoothAdapter mBluetoothAdapter = BluetoothAdapter.getDefaultAdapter();
if (mBluetoothAdapter == null) {
    // Device does not support Bluetooth
}
```

Dentro del `if` habrá que poner algún mensaje pop-up de que el teléfono no soporta bluetooth y que la aplicación procede a
cerrarse, y después cerrarla. Si el dispositivo soporta Bluetooth, pero está desactivado, se puede realizar una petición al usuario para activarlo sin salir
de la aplicación.

- 2.2. Habilitar Bluetooth

A continuación tenemos que asegurarnos de que el Bluetooth está activado. Hay que llamar a `isEnabled()` para comprobar si está
activo. Si el método devuelve `false`, está desactivado. Para hacer una petición de habilitar el Bluetooth se hace una llamada a startActivityForResult() con la acción `ACTION_REQUEST_ENABLE` del `Intent` que declararemos previamente:

```
if (!mBluetoothAdapter.isEnabled()) {
    Intent enableBtIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);
    startActivityForResult(enableBtIntent, REQUEST_ENABLE_BT);
}
```

Descripción de la clase `Intent`: https://developer.android.com/reference/android/content/Intent.html

Aparecerá un diálogo pidiendo al usuario habilitar Bluetooth. Si el usuario responde "Sí", el sistema comenzará a habilitar
el Bluetooth y volverá a la aplicación una vez que el proceso se haya completado (o haya fallado).

La constante `REQUEST_ENABLE_BT` pasada a `startActivityForResult()` es un entero definido localmente (que debe ser mayor que 0),
que el sistema pasa a `onActivityResult()` como parámetro `requestCode`.

Si se consigue habilitar el Bluetooth, la actividad recibe el resultado `RESULT_OK` (-1) como retorno de `onActivityResult()`.
Si no se consigue habilitar por un error o el usuario responde "No", el resultado recibido entonces es `RESULT_CANCELED` (0).

- 2.3. Encontrar dispositivos

Usando el `BluetoothAdapter`, se pueden encontrar dispositivos Bluetooth tanto por búsqueda como solicitando la lista de dispositivos vinculados. Al realizar búsqueda, cada dispositivo dentro del alcance que esté configurado como "descubrible" responderá a la petición compartiendo cierta información como el nombre del dispositivo, la clase y la dirección MAC. Con esta información, el dispositivo que realizar la búsqueda puede elegir iniciar una conexión con el dispositivo descubierto.

Cuando se realiza una conexión por primera vez, se presenta automáticamente una solicitud de emparejamiento al usuario. Al emparejar el dispositivo, se guarda la información básica (Nombre, clase, MAC) y se puede leer usando las APIs de Bluetooth. Conociendo la MAC de un dispositivo, puede iniciar una conexión con él sin necesidad de realizar una búsqueda.

*Importante*: Diferencia entre **emparejado** y **conectado**: Dos dispositivos **emparejados** conocen la existencia el uno del otro, tienen una clave de enlace (*link-key*) compartida que puede usarse para autenticación, y son capaces de establecer una conexión encriptada entre sí. Dos dispositivos **conectados** comparten un canal de comunicación RF (*RFCOMM*) y pueden transmitirse datos entre ellos. Las actuales APIs Bluetooth de Android requieren que los dipositivos estén emparejados antes de establecer una conexión RFCOMM (El emparejamiento se realiza automáticamente cuando inicias una conexión encriptada con las APIs de Bluetooth.

-- 2.3.1. Solicitar dispositivos emparejados
Antes de realizar una búsqueda, es mejor comprobar primero si el dispositivo deseado es ya conocido. Para hacerlo, basta con una llamada a `getBondedDevices()`. Esto devolverá un conjunto de `BluetoothDevice`s representando los dispositivos emparejados. Por ejemplo, requerir los dispotivos emparejados y mostrar el nombre de cada uno al usuario usando un `ArrayAdapter` sería:

 ```
Set<BluetoothDevice> pairedDevices = mBluetoothAdapter.getBondedDevices();
// If there are paired devices
if (pairedDevices.size() > 0) {
    // Loop through paired devices
    for (BluetoothDevice device : pairedDevices) {
        // Add the name and address to an array adapter to show in a ListView
        mArrayAdapter.add(device.getName() + "\n" + device.getAddress());
    }
}
```

Lo único que necesita el objeto de la clase `BluetoothAdapter` para iniciar una conexión es la dirección MAC. En este ejemplo, se guarda como una parte de un `ArrayAdapter` que se muestra al usuario. La dirección MAC puede ser extraída posteriormente con el objetivo de iniciar la conexión.

-- 2.3.2. Descubrir dispositivos

Para empezar a descubrir dispositivos, basta una llamada a `startDiscovery()`. El proceso es asíncrono y el método devolverá inmediatamente un booleano indicando si la búsqueda se ha iniciado satisfactoriamente. El proceso de búsqueda normalmente implica un escaneo de consulta (*inquiry scan*) de unos 12 segundos, seguido de un escaneo de página (*page scan*) de cada dispositivo para rescatar su nombre Bluetooth.

La aplicación debe registrar un `BroadcastReciver` para el `Intent` `ACTION_FOUND` para recibir información de cada dispositivo descubierto. Para cada dispositivo, el sistema transmitirá el `Intent` `ACTION_FOUND`. Este `Intent` lleva los campos extra `EXTRA_DEVICE` y`EXTRA_CLASS`, que contienen un `BluetoothDevice` y un `BluetoothClass`, respectivamente.

```
// Create a BroadcastReceiver for ACTION_FOUND
private final BroadcastReceiver mReceiver = new BroadcastReceiver() {
    public void onReceive(Context context, Intent intent) {
        String action = intent.getAction();
        // When discovery finds a device
        if (BluetoothDevice.ACTION_FOUND.equals(action)) {
            // Get the BluetoothDevice object from the Intent
            BluetoothDevice device = intent.getParcelableExtra(BluetoothDevice.EXTRA_DEVICE);
            // Add the name and address to an array adapter to show in a ListView
            mArrayAdapter.add(device.getName() + "\n" + device.getAddress());
        }
    }
};
// Register the BroadcastReceiver
IntentFilter filter = new IntentFilter(BluetoothDevice.ACTION_FOUND);
registerReceiver(mReceiver, filter); // Don't forget to unregister during onDestroy
```

Del mismo modo que antes, lo único que necesita el objeto de la clase `BluetoothAdapter` para iniciar una conexión es la dirección MAC. En este ejemplo, al igual que en el anterior, se guarda como una parte de un `ArrayAdapter` que se muestra al usuario. La dirección MAC puede ser extraída posteriormente con el objetivo de iniciar la conexión.

- 2.4. Conectar dispositivos
